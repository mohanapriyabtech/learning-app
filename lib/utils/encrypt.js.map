{"version":3,"file":"encrypt.js","names":["_crypto","_interopRequireDefault","require","_jsonwebtoken","_sessionModel","ENCRYPTION_KEY","process","env","SC_ENCRYPTION_KEY","IV_LENGTH","encrypt","text","encryptionKey","arguments","length","undefined","iv","Buffer","from","crypto","randomBytes","toString","slice","console","log","cipher","createCipheriv","encrypted","update","concat","final","decrypt","textParts","includes","split","shift","encryptedText","join","decipher","createDecipheriv","decrypted","error","message","createSession","exports","user","device","Promise","resolve","reject","tokenParams","id","_id","email","name","time","Date","valueOf","device_information","checkSession","sessionParam","session_token","jwt","sign","SECRET_KEY","user_id","session","Session","save","then","_session","catch","logoutSession","_ref","_asyncToGenerator2","default","_regenerator","mark","_callee","wrap","_callee$","_context","prev","next","findOneAndDelete","stop","_x","_x2","apply","find","_ref2","_callee2","result","_callee2$","_context2","deleteMany","_x3","err"],"sources":["../../src/utils/encrypt.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\nimport { Session } from '../modules/v1/admin/models/session-model';\n\n\nconst ENCRYPTION_KEY = process.env.SC_ENCRYPTION_KEY || 'agdjhjdhfjdjshkjgfghnbjkggnhhnbv'; // Must be 256 bits (32 characters)\nconst IV_LENGTH = 16; // For AES, this is always 16\n\nexport function encrypt(text, encryptionKey = ENCRYPTION_KEY) {\n  let iv = Buffer.from(crypto.randomBytes(IV_LENGTH)).toString('hex').slice(0, IV_LENGTH);\n  console.log(iv,\"-----------\")\n  let cipher = crypto.createCipheriv('aes-256-cbc', Buffer.from(encryptionKey), iv);\n  console.log(encryptionKey,\"-----------\")\n  let encrypted = cipher.update(text);\n\n  encrypted = Buffer.concat([encrypted, cipher.final()]);\n  return iv + ':' + encrypted.toString('hex');\n}\n\n\nexport function decrypt(text, encryptionKey = ENCRYPTION_KEY) {\n  try {\n\n    let textParts = text.includes(':') ? text.split(':') : [];\n    console.log(text,ENCRYPTION_KEY,textParts)\n    let iv = Buffer.from(textParts.shift() || '', 'binary');\n    console.log(iv,\"------\")\n    let encryptedText = Buffer.from(textParts.join(':'), 'hex');\n    let decipher = crypto.createDecipheriv('aes-256-cbc', Buffer.from(encryptionKey), iv);\n    let decrypted = decipher.update(encryptedText);\n\n    decrypted = Buffer.concat([decrypted, decipher.final()]);\n    return decrypted.toString();\n  }\n  catch (error) {\n    if (error) {\n      console.log(error.message)\n      console.log(\"error in decrypt\")\n    }\n  }\n}\n\n\nexport const createSession = (user, device) => {\n  return new Promise((resolve, reject) => {\n    let tokenParams = {\n      id: user._id,\n      email: user.email,\n      name: user.name,\n      time: new Date().valueOf()\n    }\n    if (device) {\n      tokenParams.device_information = device\n    }\n    checkSession(user._id)\n    const sessionParam = {\n      session_token: jwt.sign(tokenParams, process.env.SECRET_KEY),\n      user_id: user._id,\n    };\n\n    const session = new Session(sessionParam);\n    session.save()\n      .then(_session => {\n        resolve(_session);\n      })\n      .catch(error => {\n        reject(error.message);\n      });\n  });\n}\n\n/**\n* update user details\n* @returns Promise<error | user>\n*/\nexport const logoutSession = (session) => {\n  return new Promise(async (resolve, reject) => {\n    session = session.split(' ')\n    Session.findOneAndDelete({ session_token: session })\n      .then(session => {\n        resolve(session);\n      })\n      .catch(error => {\n        reject(error.message);\n      });\n  });\n}\n\n\n/**\n* check user session\n* @returns Promise<error | user>\n*/\nexport const checkSession = (id) => {\n  return new Promise((resolve, reject) => {\n    try {\n      Session.find({ user_id: id })\n        .then(async result => {\n          if (result.length > 50) {\n            await Session.deleteMany({ user_id: id })\n          }\n          resolve('sucess')\n        })\n        .catch(error => {\n          reject(error.message);\n        });\n    }\n    catch (err) {\n      reject(err)\n    }\n  })\n}"],"mappings":"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"}