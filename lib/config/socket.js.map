{"version":3,"file":"socket.js","names":["_socket","_interopRequireDefault","require","_socket2","SocketConfig","exports","default","server","_classCallCheck2","socketParams","cors","origin","process","env","WHITE_LISTED_DOMAINS","split","methods","transports","socket","socketIO","_createClass2","key","value","_onConnection","_asyncToGenerator2","_regenerator","mark","_callee","checkAuth","wrap","_callee$","_context","prev","next","console","log","helper","checkAuthentication","handshake","query","Authorization","id","sent","undefined","disconnect","concat","addClient","eventHandler","on","EVENTS","DISCONNECT","reason","removeClientById","stop","onConnection","_x","apply","arguments","PING","sendToSocketClients","message"],"sources":["../../src/config/socket.js"],"sourcesContent":["import socketIO from \"socket.io\"\nimport { helper } from \"../utils/socket.io-helper\";\n\n\nexport default class SocketConfig {\n\n    constructor(server) {\n        const socketParams = {\n            cors: {\n                origin: process.env.WHITE_LISTED_DOMAINS ? process.env.WHITE_LISTED_DOMAINS.split(',') : '*',\n                methods: [\"GET\", \"POST\"],\n            },\n            transports: ['websocket', 'polling'],\n        }\n        this.socket = socketIO(server, socketParams);\n    }\n\n    /**\n     * @param {*} socket \n     */\n\n    async onConnection(socket) {\n        console.log('new connection')\n        const checkAuth = await helper.checkAuthentication(socket.handshake.query.Authorization, socket.handshake.query.id)\n        if (socket.handshake.query.id == 'null' || socket.handshake.query.id === '' || socket.handshake.query.id === undefined || !checkAuth) {\n            socket.disconnect()\n            console.log(`connection failed socket id ${socket.id}`)\n        } else {\n            //add to client array\n            helper.addClient(socket);\n\n            console.log(\"A user has logged in on \" + socket.handshake.query.id);\n\n            //listner functions\n            eventHandler(socket)\n            // check on disconnected(socket);\n            socket.on(EVENTS.DISCONNECT, (reason) => {\n                helper.removeClientById(socket.handshake.query.id, socket.id);\n                //display client after disconnect\n                console.log(\n                    `a user disconneted ${socket.handshake.query.id} with socket id ${socket.id} due to ${reason}`\n                );\n            });\n        }\n    };\n}\n\n\nexport const EVENTS = {\n    DISCONNECT: 'disconnect'\n}\n\n\nexport const eventHandler = (socket) => {\n\n    socket.on(EVENTS.PING, () => {\n        helper.sendToSocketClients(socket.handshake.query.id, 'PING', { message: 'pong' })\n    })\n\n}"],"mappings":"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"}