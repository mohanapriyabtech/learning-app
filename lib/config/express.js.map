{"version":3,"file":"express.js","names":["_cors","_interopRequireDefault","require","_xssClean","_express","_expressFileupload","_expressRateLimit","corsOptions","origin","callback","process","env","WHITE_LISTED_DOMAINS","split","indexOf","console","log","Error","limiter","exports","rateLimit","windowMs","max","standardHeaders","legacyHeaders","Express","default","_createClass2","_classCallCheck2","express","app","use","xss","cors","urlencoded","limit","extended","json","fileUpload","createParentPath","err","req","res","next","message","status","statusCode"],"sources":["../../src/config/express.js"],"sourcesContent":["import cors from 'cors';\nimport xss from 'xss-clean';\nimport express from 'express';\nimport fileUpload from 'express-fileupload';\nimport rateLimit from 'express-rate-limit'\n\n/**\n * cors middleware options\n * @param {*} req \n * @param {*} callback \n */\nconst corsOptions = {\n    origin: function (origin, callback) {\n        if (process.env.WHITE_LISTED_DOMAINS.split(',').indexOf(origin) !== -1) {\n            console.log(process.env.WHITE_LISTED_DOMAINS.split(',').indexOf(origin) !== -1)\n            callback(null, true);\n        } else {\n            console.log(\"no\")\n            callback(new Error('Not allowed by CORS'));\n        }\n    }\n};\n\nexport const limiter = rateLimit({\n    windowMs: 1 * 60 * 1000, // 1 minute\n    max: 200, // Limit each IP to 100 requests per `window` (here, per 1 minute)\n    // message:'Too many accounts created from this IP, please try again after an hour',\n    standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers\n    legacyHeaders: false, // Disable the `X-RateLimit-*` headers\n})\n\n\nexport default class Express {\n\n    constructor() {\n        this.express = express;\n        this.app = new express();\n        // sanitize request data\n        this.app.use(xss());\n        this.app.use(cors(corsOptions));\n        // parse urlencoded request body\n        this.app.use(this.express.urlencoded({ limit: '50mb', extended: true }));\n        // parse response body\n        this.app.use(this.express.json({ limit: '50mb' }));\n        // to handle uploading files\n        this.app.use(fileUpload({\n            createParentPath: true,\n        }));\n        this.app.use(limiter)\n        // error handling middleware\n        this.app.use(function (err, req, res, next) {\n            if (err.message === 'Not allowed by CORS') {\n                res.status(403).json({\n                    status: false,\n                    statusCode: 403,\n                    message: 'please visit our official website'\n                })\n            } else {\n                next(err);\n            }\n        });\n    }\n}\n\n"],"mappings":";;;;;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,QAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,kBAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,iBAAA,GAAAL,sBAAA,CAAAC,OAAA;AAEA;AACA;AACA;AACA;AACA;AACA,IAAMK,WAAW,GAAG;EAChBC,MAAM,EAAE,SAAAA,OAAUA,OAAM,EAAEC,QAAQ,EAAE;IAChC,IAAIC,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,OAAO,CAACN,OAAM,CAAC,KAAK,CAAC,CAAC,EAAE;MACpEO,OAAO,CAACC,GAAG,CAACN,OAAO,CAACC,GAAG,CAACC,oBAAoB,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,OAAO,CAACN,OAAM,CAAC,KAAK,CAAC,CAAC,CAAC;MAC/EC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC;IACxB,CAAC,MAAM;MACHM,OAAO,CAACC,GAAG,CAAC,IAAI,CAAC;MACjBP,QAAQ,CAAC,IAAIQ,KAAK,CAAC,qBAAqB,CAAC,CAAC;IAC9C;EACJ;AACJ,CAAC;AAEM,IAAMC,OAAO,GAAAC,OAAA,CAAAD,OAAA,GAAG,IAAAE,yBAAS,EAAC;EAC7BC,QAAQ,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI;EAAE;EACzBC,GAAG,EAAE,GAAG;EAAE;EACV;EACAC,eAAe,EAAE,IAAI;EAAE;EACvBC,aAAa,EAAE,KAAK,CAAE;AAC1B,CAAC,CAAC;AAAA,IAGmBC,OAAO,GAAAN,OAAA,CAAAO,OAAA,oBAAAC,aAAA,CAAAD,OAAA,EAExB,SAAAD,QAAA,EAAc;EAAA,IAAAG,gBAAA,CAAAF,OAAA,QAAAD,OAAA;EACV,IAAI,CAACI,OAAO,GAAGA,gBAAO;EACtB,IAAI,CAACC,GAAG,GAAG,IAAID,gBAAO,CAAC,CAAC;EACxB;EACA,IAAI,CAACC,GAAG,CAACC,GAAG,CAAC,IAAAC,iBAAG,EAAC,CAAC,CAAC;EACnB,IAAI,CAACF,GAAG,CAACC,GAAG,CAAC,IAAAE,aAAI,EAAC1B,WAAW,CAAC,CAAC;EAC/B;EACA,IAAI,CAACuB,GAAG,CAACC,GAAG,CAAC,IAAI,CAACF,OAAO,CAACK,UAAU,CAAC;IAAEC,KAAK,EAAE,MAAM;IAAEC,QAAQ,EAAE;EAAK,CAAC,CAAC,CAAC;EACxE;EACA,IAAI,CAACN,GAAG,CAACC,GAAG,CAAC,IAAI,CAACF,OAAO,CAACQ,IAAI,CAAC;IAAEF,KAAK,EAAE;EAAO,CAAC,CAAC,CAAC;EAClD;EACA,IAAI,CAACL,GAAG,CAACC,GAAG,CAAC,IAAAO,0BAAU,EAAC;IACpBC,gBAAgB,EAAE;EACtB,CAAC,CAAC,CAAC;EACH,IAAI,CAACT,GAAG,CAACC,GAAG,CAACb,OAAO,CAAC;EACrB;EACA,IAAI,CAACY,GAAG,CAACC,GAAG,CAAC,UAAUS,GAAG,EAAEC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;IACxC,IAAIH,GAAG,CAACI,OAAO,KAAK,qBAAqB,EAAE;MACvCF,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACR,IAAI,CAAC;QACjBQ,MAAM,EAAE,KAAK;QACbC,UAAU,EAAE,GAAG;QACfF,OAAO,EAAE;MACb,CAAC,CAAC;IACN,CAAC,MAAM;MACHD,IAAI,CAACH,GAAG,CAAC;IACb;EACJ,CAAC,CAAC;AACN,CAAC"}